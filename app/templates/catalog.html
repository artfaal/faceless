{% extends "layout.html" -%}
{# TITLE BLOCK -#}
{% block title -%}
    {% if item_page -%}
        {{ item_page['name'] }}
    {% elif category_page -%}
        {{ category_page['name'] }}
    {% else -%}
        Каталог
    {% endif -%}
{% endblock -%}
{# DESCRIPTION -#}
{% block description -%}
    {% if item_page -%}
        {{ item_page['meta_description'] }}
    {% elif category_page -%}
        {{ category_page['meta_description'] }}
    {% else -%}
        Каталог компании ЕОС-Премиум-СПА Технологии
    {% endif -%}
{% endblock -%}
{# KEYWORDS -#}
{% block keywords -%}
    {% if item_page -%}
        {{ item_page['meta_keywords'] }}
    {% elif category_page -%}
        {{ category_page['meta_keywords'] }}
    {% else -%}
        ЕОС-Премиум-СПА Технологии
    {% endif -%}
{% endblock -%}

{% block header -%}{{ super() }}{% endblock -%}
{% block nav -%}{{ super() }}{% endblock -%}

{% block content -%}

<div class="row">

    {# Здесь сайдбар #}
    {% block sidebar_item -%}{{ super() }}{% endblock -%}
    {# Конец сайдбара -#}

    {# Main fraim
    ======================================= -#}
    <div class="content-box nine columns omega">

        {# Если это страница товара
        ======================================= -#}
        {% if item_page -%}
        <div class="four columns alpha">
            {%set path_to_img = 'items/' + item_page['img'][0]['filename']%}
            {%set alt = item_page['img'][0]['alt'] %}
            {%set thumb = path_to_img|thumbnail('280x417')%}
            <a href="{{ url_for('img', filename=path_to_img) }}" data-lightbox="roadtrip" data-title="{{alt}}"><img src="{{ thumb }}" alt="{{alt}}"></a>
            {# Хитрая проверка. Если в Array есть вторая позиция, то едем дальше #}
            {% if item_page['img'][1] %}
                <br>
                {# А здесь начинаем сразу со второго элемента #}
                {%for i in item_page['img'][1:] %}
                    {%set path_to_img = 'items/' + i['filename']%}
                    {%set alt = i['alt'] %}
                    {%set mini_thumb = path_to_img|thumbnail('80x80', 'fit')%}
                    <a href="{{ url_for('img', filename=path_to_img) }}" data-lightbox="roadtrip" data-title="{{alt}}"><img src="{{ mini_thumb }}" alt="{{alt}}"></a>
                {% endfor %}
            {% endif %}
        </div>
        <div class="">
            <h1>{{ item_page['name'] }}</h1>
            {{ item_page['body']|markdown }}
            <hr>
            {% if item_page['doc'] > 0 -%}
                    {% for i in item_page['doc'] -%}
                        <p>
                            <a href="{{ url_for('doc', filename=i['filename']) }}">Скачать ></a> {{i['alt']}}
                            <br>
                        </p>
                    {% endfor -%}
            {% endif -%}
            <br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
        </div>
        {# Если это Категория c дочерними категориями
        ======================================= -#}
        {% elif category_page -%}
            <h1>{{category_page['name']}}</h1>
            <p>{{category_page['mini_description']}}</p>
            {# Если это Категория с дочерними
            ======================================= -#}
            {%if category_page['child_category']|length > 0 -%}
                {# Теперь итерируем дочерние категории в ней #}
                {% for name in category_page['child_category'] %}
                <button type="" class="btn-category"><a href="#{{name['name']}}">{{name['name']}}</a></button>
                {% endfor %}
                {% for i in category_page['child_category']-%}
                    <h2><a name="{{i['name']}}"></a>{{i['name']}}</h2>
                    <hr>
                    {# Этот кусок должен фильтровать товары, который есть внутри #}
                    {% for item in items_from_child_category(i['name']) -%}
                        <a href="{{category_page['slug']}}/{{ item['slug'] }}"><div class="box-items">

                            {%set path_to_img = 'items/' + item['img'][0]['filename']%}
                            {%set thumb = path_to_img|thumbnail('145x150')%}
                            <div class="wrap-img">
                                <img src="{{ thumb }}">
                            </div>
                            <div class="list-item-text">
                              <h2>{{ item['name'] }}</h2>
                              <hr>
                              <p>{{ item['body']|truncate(50)|replace('**', '')|replace('*', '')|replace('##', '')|replace('###', '')}}</p>
                            </div>
                        </div></a>
                    {% endfor -%}
                    <div class="clear"></div>
                {% endfor-%}

            {# Если это Категория без дочерних
            ======================================= -#}
            {% else -%}
                {% for item in items_from_main_category() -%}
                    <a href="{{category_page['slug']}}/{{ item['slug'] }}"><div class="box-items">
                        {%set path_to_img = 'items/' + item['img'][0]['filename']%}
                        {%set thumb = path_to_img|thumbnail('145x150')%}
                        <div class="wrap-img">
                            <img src="{{ thumb }}">
                        </div>
                        <div class="list-item-text">
                          <h2>{{ item['name'] }}</h2>
                          <hr>
                          <p>{{ item['body']|truncate(40)|replace('**', '')|replace('*', '')|replace('##', '')|replace('###', '')}}</p>
                        </div>
                    </div></a>
                {% endfor -%}
                <div class="clear"></div>
            {% endif -%}
        <hr>
        <h3>Описание категории</h3>
        <p>{{category_page['body']|markdown}}</p>
        {# Если это стартовая страница каталога
        ======================================= -#}
        {% else-%}
            <h1>Каталог</h1>
            <hr>
            {% for c in category() -%}
                <a href="{{ c['slug'] }}"><div class="box-category">
                {%set path_to_img = 'category/' + c['img'][0]['filename']%}
                {%set thumb = path_to_img|thumbnail('170x245')%}
                <img src="{{ thumb }}">

                <div class="list-item-text">
                  <h2>{{ c['name'] }}</h2>
                  <p>{{ c['mini_description']|truncate(75) }}</p>
                </div>
                </div></a>
            {% endfor -%}
        {% endif -%}

    </div>
    {# Main frame end
    ======================================= -#}

</div>
{% endblock -%}
